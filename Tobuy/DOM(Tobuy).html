<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To buy list</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        ul,li {
            padding: 0;
            list-style: none;
        }
    </style>
</head>
<body>
    <h1 id="title">주문할 것</h1>
    <div>
        <input type="text" class="buy">
        <button class="add" type="submit">추가</button>
    </div>
    <ul class="addList">
        <!-- <li>
            <input type="checkbox">
            <span>당근</span>
            <button class="del" type="button">삭제</button>
        </li>
        <li>
            <input type="checkbox">
            <span>오이</span>
            <button class="del" type="button">삭제</button>
        </li>
        <li>
            <input type="checkbox">
            <span>양파</span>
            <button class="del" type="button">삭제</button>
        </li> -->
    </ul>
    <button class="end" type="button">전체 삭제</button>

    <script>
        const buy = document.querySelector('.buy')
        const add = document.querySelector('.add')
        const addList = document.querySelector('.addList')
        const end = document.querySelector('.end')
        end.style.display = "none"

        const input = document.createElement("input")
        input.setAttribute("type","checkbox")
        const span = document.createElement('span')
        const del = document.createElement('button')
        del.textContent = '삭제'
        

        // input 입력후 추가버튼 클릭시 추가 li>input,span,button생성
        const items = []

        add.addEventListener('click', ()=>{
                const list = document.createElement('li')
                addList.append(list)

                const itemInput = input.cloneNode(true)
                const itemSpan= span.cloneNode(true)
                const itemDel = del.cloneNode(true)
                
                list.append(itemInput,itemSpan,itemDel)
                itemSpan.textContent = buy.value
                buy.value = ''
                //각 아이템 객체로저장 이벤트리스너 등록
                items.push({input: itemInput, span: itemSpan, del: itemDel})
                cancel(items)
                end.style.display = "block"

        })
        
        // 체크박스 체크시 span 텍스트 완료표시로 취소선 생성
        function cancel(itemArray) {
            items.forEach(item=>{
                item.input.addEventListener('click', ()=>{
                    const textCont = item.span.textContent
                    if(item.input.checked){
                        item.span.innerHTML = `<del>${textCont}</del>`
                    } else {
                        item.span.innerHTML = textCont
                    }
                })
                // 삭제버튼 클릭시 해당 인덱스에 맞는 li제거
                item.del.addEventListener('click', () => {
                    item.span.remove()
                    item.input.remove()
                    item.del.remove()
                });
            })
        }
        end.addEventListener('click', ()=>{
            addList.innerHTML = ''
            end.style.display = 'none'
        })
    </script>
</body>
</html>